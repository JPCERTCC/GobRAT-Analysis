

import "elf"

rule malware_GobRAT_arm {
    meta:
        description = "Hunting GobRAT malware"
        author = "JPCERT/CC Incident Response Group"
        rule_usage = "Hunting"
        hash = "39438597FAF8D9A4024589847F2E7E441E3A9D63501B724FD9DDDA028A9B19FB"
    
    strings:
        /* Function Address: 0x26a4a0 : aaa.com_bbb_meutil._debug
        01 20 A0 E1                         MOV             R2, R1        
        B4 10 8D E2                         ADD             R1, SP, #0x118+var_64
        00 30 A0 E1                         MOV             R3, R0        
        00 00 A0 E3                         MOV             R0, #0        
        */
        $func0 = { 01 20 A0 E1 B4 10 8D E2 00 30 A0 E1 00 00 A0 E3 }

        /* Function Address: 0x2643b4 : aaa.com_bbb_menet.GetMacAddress
        01 40 84 E2                         ADD             R4, R4, #1    
        07 50 A0 E1                         MOV             R5, R7        
        01 00 54 E1                         CMP             R4, R1        
        */
        $func1 = { 01 40 84 E2 07 50 A0 E1 01 00 54 E1 }

        /* Function Address: 0x26b524 : aaa.com_bbb_meutil.GenerateTLSConfig
        01 30 A0 E1                         MOV             R3, R1        
        A8 10 8D E2                         ADD             R1, SP, #0x3E0+var_338
        00 40 A0 E1                         MOV             R4, R0        
        00 00 A0 E3                         MOV             R0, #0        
        */
        $func2 = { 01 30 A0 E1 A8 10 8D E2 00 40 A0 E1 00 00 A0 E3 }

        /* Function Address: 0x26b068 : aaa.com_bbb_meutil.GenerateRandomHex
        92 43 82 E0                         UMULL           R4, R2, R2, R3
        03 01 C0 E3                         BIC             R0, R0, #0xC0000000
        00 50 94 E0                         ADDS            R5, R4, R0    
        */
        $func3 = { 92 43 82 E0 03 01 C0 E3 00 50 94 E0 }

        /* Function Address: 0x26bdc0 : aaa.com_bbb_meutil.Daemon1
        00 50 E0 E3                         MOV             R5, #0xFFFFFFFF
        01 60 A0 E1                         MOV             R6, R1        
        9C 10 8D E2                         ADD             R1, SP, #0xC0+var_24
        00 70 A0 E1                         MOV             R7, R0        
        00 00 A0 E3                         MOV             R0, #0        
        */
        $func4 = { 00 50 E0 E3 01 60 A0 E1 9C 10 8D E2 00 70 A0 E1 00 00 A0 E3 }

        /* Function Address: 0x26c37c : aaa.com_bbb_meutil.Daemon2
        08 50 05 E2                         AND             R5, R5, #8    
        05 40 84 E0                         ADD             R4, R4, R5    
        01 50 42 E2                         SUB             R5, R2, #1    
        01 60 43 E2                         SUB             R6, R3, #1    
        06 00 52 E1                         CMP             R2, R6        
        */
        $func5 = { 08 50 05 E2 05 40 84 E0 01 50 42 E2 01 60 43 E2 06 00 52 E1 }


    condition:
        (uint32(0) == 0x464C457F)
        and (elf.machine == elf.EM_ARM)
        and (filesize < 9MB)
        and (filesize > 2MB)
        and ( 5 of ($func*) )

}
    